<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Statistics - Video Downloader Admin</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
      rel="stylesheet"
    />
    <style>
      .stat-card {
        border: none;
        border-radius: 10px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      }
      .bg-custom-primary {
        background: #007bff;
        color: white;
      }
      .bg-custom-success {
        background: #28a745;
        color: white;
      }
      .bg-custom-info {
        background: #17a2b8;
        color: white;
      }
      .bg-custom-warning {
        background: #ffc107;
        color: black;
      }
      .bg-custom-danger {
        background: #dc3545;
        color: white;
      }
    </style>
  </head>
  <body>
    <div class="container-fluid py-4">
      <div class="d-flex justify-content-between align-items-center mb-4">
        <h1 class="h3">
          <i class="fas fa-chart-bar text-primary"></i>
          Download Statistics
        </h1>
        <div>
          <a href="/admin/user/" class="btn btn-outline-primary btn-sm">
            <i class="fas fa-users"></i> Users
          </a>
          <a href="/admin/download/" class="btn btn-outline-success btn-sm">
            <i class="fas fa-download"></i> Downloads
          </a>
          <a href="{{ url_for('index') }}" class="btn btn-outline-info btn-sm">
            <i class="fas fa-home"></i> App
          </a>
        </div>
      </div>

      <!-- Summary Cards -->
      <div class="row mb-4">
        <div class="col-md-3 mb-3">
          <div class="card stat-card bg-custom-primary">
            <div class="card-body text-center">
              <i class="fas fa-users fa-2x mb-2"></i>
              <h3>{{ total_users }}</h3>
              <p class="mb-0">Total Users</p>
              <small>+{{ new_users_today }} today</small>
            </div>
          </div>
        </div>
        <div class="col-md-3 mb-3">
          <div class="card stat-card bg-custom-success">
            <div class="card-body text-center">
              <i class="fas fa-download fa-2x mb-2"></i>
              <h3>{{ total_downloads }}</h3>
              <p class="mb-0">Total Downloads</p>
              <small>{{ today_downloads }} today</small>
            </div>
          </div>
        </div>
        <div class="col-md-3 mb-3">
          <div class="card stat-card bg-custom-info">
            <div class="card-body text-center">
              <i class="fas fa-check-circle fa-2x mb-2"></i>
              <h3>{{ "%.1f"|format(success_rate) }}%</h3>
              <p class="mb-0">Success Rate</p>
              <small>{{ success_count }} successful</small>
            </div>
          </div>
        </div>
        <div class="col-md-3 mb-3">
          <div class="card stat-card bg-custom-warning">
            <div class="card-body text-center">
              <i class="fas fa-calendar-week fa-2x mb-2"></i>
              <h3>{{ weekly_downloads }}</h3>
              <p class="mb-0">This Week</p>
              <small>Last 7 days</small>
            </div>
          </div>
        </div>
      </div>

      <!-- Format Statistics -->
      <div class="row">
        <div class="col-md-6">
          <div class="card">
            <div class="card-header bg-primary text-white">
              <h5 class="card-title mb-0">
                <i class="fas fa-file-alt"></i> Downloads by Format
              </h5>
            </div>
            <div class="card-body">
              <table class="table table-striped">
                <thead>
                  <tr>
                    <th>Format</th>
                    <th>Count</th>
                    <th>Percentage</th>
                  </tr>
                </thead>
                <tbody>
                  {% for stat in format_stats %}
                  <tr>
                    <td>
                      <span class="badge bg-primary">
                        {{ stat.format_type.upper() if stat.format_type else
                        'Unknown' }}
                      </span>
                    </td>
                    <td><strong>{{ stat.count }}</strong></td>
                    <td>
                      {{ "%.1f"|format(stat.count / total_downloads * 100) if
                      total_downloads > 0 else 0 }}%
                    </td>
                  </tr>
                  {% endfor %}
                </tbody>
              </table>
            </div>
          </div>
        </div>

        <div class="col-md-6">
          <div class="card">
            <div class="card-header bg-success text-white">
              <h5 class="card-title mb-0">
                <i class="fas fa-globe"></i> Downloads by Platform
              </h5>
            </div>
            <div class="card-body">
              <table class="table table-striped">
                <thead>
                  <tr>
                    <th>Platform</th>
                    <th>Count</th>
                    <th>Percentage</th>
                  </tr>
                </thead>
                <tbody>
                  {% for stat in platform_stats %}
                  <tr>
                    <td>
                      <span class="badge bg-success">
                        {{ stat.platform|title }}
                      </span>
                    </td>
                    <td><strong>{{ stat.count }}</strong></td>
                    <td>
                      {{ "%.1f"|format(stat.count / total_downloads * 100) if
                      total_downloads > 0 else 0 }}%
                    </td>
                  </tr>
                  {% endfor %}
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>

      <!-- Quick Stats -->
      <div class="row mt-4">
        <div class="col-12">
          <div class="card">
            <div class="card-header bg-dark text-white">
              <h5 class="card-title mb-0">
                <i class="fas fa-info-circle"></i> Quick Stats
              </h5>
            </div>
            <div class="card-body">
              <div class="row text-center">
                <div class="col-md-4">
                  <h6>Most Popular Format</h6>
                  <h4 class="text-primary">
                    {{ most_popular_format[0].upper() if most_popular_format
                    else 'N/A' }}
                  </h4>
                  <small
                    >{{ most_popular_format[1] if most_popular_format else 0 }}
                    downloads</small
                  >
                </div>
                <div class="col-md-4">
                  <h6>Most Active Platform</h6>
                  <h4 class="text-success">
                    {{ most_active_platform[0].title() if most_active_platform
                    else 'N/A' }}
                  </h4>
                  <small
                    >{{ most_active_platform[1] if most_active_platform else 0
                    }} downloads</small
                  >
                </div>
                <div class="col-md-4">
                  <h6>Failed Downloads</h6>
                  <h4 class="text-danger">{{ failed_downloads }}</h4>
                  <small
                    >{{ "%.1f"|format((failed_downloads / total_downloads * 100)
                    if total_downloads > 0 else 0) }}% of total</small
                  >
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
  </body>
</html>
